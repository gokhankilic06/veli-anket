
<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
  <title>Yavuz Sultan Selim İlkokulu Riba Veli Anketi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Riba Veli Anketi</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js">function exportTableToExcel() {
  const table = document.getElementById("individualAnswers");
  let csv = [];
  for (let row of table.rows) {
    let cols = Array.from(row.cells).map(cell => '"' + cell.innerText + '"');
    csv.push(cols.join(","));
  }
  const csvContent = "data:text/csv;charset=utf-8," + csv.join("
");
  const encodedUri = encodeURI(csvContent);
  const link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", "bireysel_yanitlar.csv");
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
</script>
<style>
    body {
      padding: 20px;
      background: linear-gradient(to bottom right, #eaf4ff, #ffffff);
      font-family: 'Segoe UI', sans-serif;
    }
    .hidden {
      display: none;
    }
    .form-section {
      max-width: 700px;
      margin: 0 auto;
    }
    body { padding: 20px; }
</style>
</head>
<body>
<div class="container text-center mt-5" id="entryScreen">
  <div class="container text-center mt-5" id="entryScreen">
<h1 class="mb-4">Yavuz Sultan Selim İlkokulu</h1>
<h3 class="mb-4">Riba Veli Anket Sistemi</h3>
<div class="d-grid gap-3 col-6 mx-auto">
    <button onclick="showForm();" class="btn btn-primary">Veli Girişi</button>
    <button onclick="showAdminLogin();" class="btn btn-secondary">Yönetici Girişi</button>
  </div>
    <button onclick="document.getElementById('formSection').classList.remove('hidden'); document.getElementById('entryScreen').classList.add('hidden');" class="btn btn-primary">Veli Girişi</button>
</div>
</div>

<div id="formSection" class="hidden mt-4 form-section">
    <input class="form-select mb-3" placeholder="Veli adı soyadı" id="name" required />
    <input type="text" class="form-control mb-3" placeholder="Veli adı soyadı" id="name" required />
<select class="form-select mb-3" id="class" required>
<option selected disabled>Öğrencinin sınıfı</option>
<option>3-A</option><option>3-B</option><option>3-C</option><option>3-D</option><option>3-E</option><option>3-F</option><option>3-G</option><option>3-H</option><option>4-A</option><option>4-B</option><option>4-C</option><option>4-D</option><option>4-E</option><option>4-F</option><option>4-G</option><option>4-H</option>
</select>
    <p><strong>Açıklama:</strong> Değerli velimiz, bu form çocuğunuzun eğitsel, kişisel ve sosyal gelişimini desteklemek amacıyla hazırlanmıştır.</p>
    <p><strong>Açıklama:</strong> Sayın Veli,
Bu anketin amacı okulda öğrencilerimizin hangi rehberlik hizmetlerine ihtiyaç duyduğunu belirlemektir. Her
soruda A ve B olmak üzere iki  rehberlik hizmeti verilmektedir. Sorulara yanıt verirken çocuğunuzun hangi
konuda öncelikli olarak rehberlik hizmeti alması gerektiğini düşününüz. Soruda verilen iki rehberlik hizmetini
karşılaştırınız ve bu hizmetlerden sadece bir tanesini seçiniz.</p>
<form onsubmit="submitForm(event)">

<div class="mb-3">
@@ -140,207 +113,40 @@ <h3 class="mb-4">Riba Veli Anket Sistemi</h3>
</form>
</div>

<div id="adminLogin" class="hidden col-md-4 mx-auto mt-4">
  <input type="password" id="adminPass" class="form-control mb-2" placeholder="Şifre" />
  <button class="btn btn-dark w-100" onclick="loginAdmin()">Giriş</button>
</div>

<div id="adminPanel" class="hidden mt-4">
  <h3 class="mb-3">Yönetici Paneli</h3>
  <p id="participantCount" class="text-start ms-2"></p>
  <table class="table table-bordered table-sm" id="adminTable">
    <thead>
      <tr>
        <th>Sıra No</th>
        <th>Ad Soyad</th>
        <th>Sınıf</th>
        <th>Yanıtlar</th>
        <th>İşlem</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="text-end mt-2">
    <button class="btn btn-danger btn-sm" onclick="resetAllData()">Verileri Sıfırla</button>
  </div>

<h4 class="mt-5">Soru Bazlı Dağılım</h4>
<table class="table table-bordered table-sm" id="questionStats">
  <thead>
    <tr>
      <th>Soru</th>
      <th>A Seçeneği</th>
      <th>B Seçeneği</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<h4 class="mt-5">Bireysel Yanıt Tablosu <button class='btn btn-sm btn-success ms-2' onclick='exportTableToExcel()'>Excel'e Aktar</button></h4>
<table class="table table-bordered table-sm" id="individualAnswers">
  <thead>
    <tr>
      <th rowspan="2">No</th>
      <th rowspan="2">Adı Soyadı</th>
      <th colspan="2">M1</th>
      <th colspan="2">M2</th>
      <th colspan="2">M3</th>
      <th colspan="2">M4</th>
      <th colspan="2">M5</th>
      <th colspan="2">M6</th>
      <th colspan="2">M7</th>
      <th colspan="2">M8</th>
      <th colspan="2">M9</th>
      <th colspan="2">M10</th>
      <th colspan="2">M11</th>
      <th colspan="2">M12</th>
      <th colspan="2">M13</th>
    </tr>
    <tr>
      <th>A</th><th>B</th>
      <th>A</th><th>B</th>
      <th>A</th><th>B</th>
      <th>A</th><th>B</th>
      <th>A</th><th>B</th>
      <th>A</th><th>B</th>
      <th>A</th><th>B</th>
      <th>A</th><th>B</th>
      <th>A</th><th>B</th>
      <th>A</th><th>B</th>
      <th>A</th><th>B</th>
      <th>A</th><th>B</th>
      <th>A</th><th>B</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
    
<script>
  function showForm() {
  document.getElementById('formSection').classList.remove('hidden');
  document.getElementById('adminLogin').classList.add('hidden');
  document.getElementById('adminPanel').classList.add('hidden');
}

  function showAdminLogin() {
  document.getElementById('formSection').classList.add('hidden');
  document.getElementById('adminLogin').classList.remove('hidden');
}

function loginAdmin() {
  const pass = document.getElementById('adminPass').value;
  if (pass === 'admin123') {
    document.getElementById('adminLogin').classList.add('hidden');
    document.getElementById('adminPanel').classList.remove('hidden');
    loadAdminData();
  } else {
    alert('Şifre yanlış!');
  }
}

function loadAdminData() {
  updateQuestionStats();
  updateIndividualAnswers();
  const stored = JSON.parse(localStorage.getItem('results') || '[]');
  document.getElementById('participantCount').innerText = `${stored.length} kişi ankete katılmıştır.`;
  const tbody = document.querySelector('#adminTable tbody');
  tbody.innerHTML = '';
  stored.forEach((entry, index) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${index + 1}</td>
      <td>${entry.name}</td>
      <td>${entry.className}</td>
      <td>${entry.answers.join(', ')}</td>
      <td><button class="btn btn-sm btn-danger" onclick="deleteEntry(${index})">Sil</button></td>
    `;
    tbody.appendChild(tr);
  });
}

function deleteEntry(index) {
  const stored = JSON.parse(localStorage.getItem('results') || '[]');
  if (confirm('Bu kaydı silmek istediğinize emin misiniz?')) {
    stored.splice(index, 1);
    localStorage.setItem('results', JSON.stringify(stored));
    loadAdminData();
  }
}

function updateIndividualAnswers() {
  const stored = JSON.parse(localStorage.getItem('results') || '[]');
  const tbody = document.querySelector('#individualAnswers tbody');
  tbody.innerHTML = '';
  stored.forEach((entry, index) => {
    const tr = document.createElement('tr');
    let row = `<td>${index + 1}</td><td>${entry.name}</td>`;
    for (let i = 0; i < 13; i++) {
      const isA = entry.answers[i] === 'A' ? '1' : '';
      const isB = entry.answers[i] === 'B' ? '1' : '';
      row += `<td>${isA}</td><td>${isB}</td>`;
    }
    tr.innerHTML = row;
    tbody.appendChild(tr);
  });
}

function updateQuestionStats() {
  const stored = JSON.parse(localStorage.getItem('results') || '[]');
  const stats = Array.from({ length: 13 }, () => ({ A: 0, B: 0 }));
  stored.forEach(entry => {
    entry.answers.forEach((answer, i) => {
      if (answer === 'A') stats[i].A++;
      else if (answer === 'B') stats[i].B++;
    });
  });
  const tbody = document.querySelector('#questionStats tbody');
  tbody.innerHTML = '';
  stats.forEach((row, i) => {
    const tr = document.createElement('tr');
    const total = row.A + row.B;
    const percent = total === 0 ? 0 : Math.round((row.A / total) * 100);
    const percentB = total === 0 ? 0 : Math.round((row.B / total) * 100);
    tr.innerHTML = `<td>${i + 1}. Soru</td><td>${row.A} (${percent}%)</td><td>${row.B} (${percentB}%)</td>`;
    tbody.appendChild(tr);
  });
}
function resetAllData() {
  if (confirm('Tüm verileri silmek istediğinize emin misiniz?')) {
    localStorage.removeItem('results');
    loadAdminData();
  }
}

function submitForm(event) {
    event.preventDefault();
    const name = document.getElementById('name').value.trim();
    const className = document.getElementById('class').value;

    if (!name || className === 'Öğrencinin sınıfı') {
      alert('Lütfen tüm alanları doldurunuz.');
      return;
    }

    const answers = [];
    for (let i = 0; i < 13; i++) {
      const selected = document.querySelector(`input[name=q${i}]:checked`);
      if (!selected) {
        alert(`Lütfen ${i + 1}. soruyu cevaplayınız.`);
        return;
function submitForm(e) {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const className = document.getElementById("class").value;
      const answers = [];
      for (let i = 0; i < 13; i++) {
        const selected = document.querySelector(`input[name='q${i}']:checked`);
        if (!selected) return alert("Lütfen tüm soruları yanıtlayınız.");
        answers.push(selected.value);
}
      answers.push(selected.value);
    }

    const data = { name, className, answers };
    const stored = JSON.parse(localStorage.getItem('results') || '[]');
    stored.push(data);
    localStorage.setItem('results', JSON.stringify(stored));

    alert('Yanıtınız kaydedildi. Teşekkür ederiz.');
    document.querySelector('form').reset();
document.getElementById('name').value = '';
document.getElementById('class').selectedIndex = 0;
  
    // Burada form verileri işlenebilir veya gönderilebilir
  }
</script>
      fetch("https://script.google.com/macros/s/AKfycbwqB7eGPC9I9RQ0AHOmok8WpWFYtxdYe1bA8v9Au-iRFUS-yIv18tiNRjH6l54rDqw-vQ/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, className, answers })
      })
      .then(res => res.text())
      .then(response => {
        if (response === "OK") {
          alert("Yanıtınız kaydedildi. Teşekkür ederiz.");
          document.querySelector("form").reset();
        } else {
          alert("Gönderim başarısız oldu.
Sunucu yanıtı: " + response);
        }
      })
      .catch(error => {
        console.error("Hata:", error);
        alert("Bir hata oluştu. Lütfen tekrar deneyiniz.");
      });
    }
  </script>
</body>
</html>
